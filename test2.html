<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Perekam Video dengan Durasi</title>
  <style>
    body { font-family: sans-serif; margin: 30px; background: #f5f5f5; }
    .video-container {
      position: relative;
      display: inline-block;
      margin-bottom: 15px;
    }
    video { max-width: 100%; border: 2px solid #333; border-radius: 8px; display: block; }
    .overlay {
      position: absolute;
      top: 5px;
      padding: 3px 6px;
      background: rgba(0,0,0,0.6);
      color: #fff;
      font-size: 14px;
      border-radius: 4px;
    }
    .left { left: 5px; }
    .right { right: 5px; }
    button { margin: 5px; padding: 10px 15px; }
    .recordings { margin-top: 20px; }
    .recording { margin-bottom: 20px; display: inline-block; position: relative; }
    .recording .duration {
      position: absolute;
      top: 5px; right: 5px;
      background: rgba(0,0,0,0.6);
      color: #fff;
      padding: 3px 6px;
      font-size: 14px;
      border-radius: 4px;
    }
  </style>
</head>
<body>
  <h1>ðŸ“¹ Perekam Video</h1>

  <div class="video-container">
    <video id="preview" autoplay muted></video>
    <div id="timerOverlay" class="overlay left">00:00</div>
  </div><br>

  <button id="startBtn">Mulai Rekam</button>
  <button id="stopBtn" disabled>Stop</button>

  <div class="recordings" id="recordings"></div>

  <script>
    const startBtn = document.getElementById('startBtn');
    const stopBtn = document.getElementById('stopBtn');
    const preview = document.getElementById('preview');
    const timerOverlay = document.getElementById('timerOverlay');
    const recordings = document.getElementById('recordings');

    let mediaRecorder;
    let chunks = [];
    let startTime;
    let timerInterval;

    function updateTimer() {
      const diff = Math.floor((Date.now() - startTime) / 1000);
      const m = String(Math.floor(diff / 60)).padStart(2, '0');
      const s = String(diff % 60).padStart(2, '0');
      timerOverlay.textContent = `${m}:${s}`;
      return timerOverlay.textContent;
    }

    startBtn.onclick = async () => {
      const stream = await navigator.mediaDevices.getUserMedia({ video: true, audio: true });
      preview.srcObject = stream;

      mediaRecorder = new MediaRecorder(stream);

      mediaRecorder.ondataavailable = e => {
        if (e.data.size > 0) chunks.push(e.data);
      };

      mediaRecorder.onstop = () => {
        const blob = new Blob(chunks, { type: 'video/webm' });
        const url = URL.createObjectURL(blob);
        const finalDuration = updateTimer();

        const recDiv = document.createElement('div');
        recDiv.classList.add('recording');
        recDiv.innerHTML = `
          <video controls src="${url}" width="320"></video>
          <div class="duration">${finalDuration}</div>
        `;
        recordings.appendChild(recDiv);

        chunks = [];
        clearInterval(timerInterval);
        timerOverlay.textContent = '00:00';
      };

      mediaRecorder.start();
      startTime = Date.now();
      timerInterval = setInterval(updateTimer, 500);

      startBtn.disabled = true;
      stopBtn.disabled = false;
    };

    stopBtn.onclick = () => {
      mediaRecorder.stop();
      startBtn.disabled = false;
      stopBtn.disabled = true;
    };
  </script>
</body>
</html>
